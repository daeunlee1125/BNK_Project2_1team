<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.api.backend.mapper.DpstAcctDraftMapper">

    <resultMap id="DepositDraftMap" type="kr.co.api.backend.dto.DpstAcctDraftDTO" autoMapping="true">
        <id property="dpstDraftNo" column="DPST_DRAFT_NO"/>
        <result property="dpstDraftDpstId" column="DPST_DRAFT_DPST_ID"/>
        <result property="dpstDraftCustCode" column="DPST_DRAFT_CUST_CODE"/>
        <result property="dpstDraftMonth" column="DPST_DRAFT_MONTH"/>
        <result property="dpstDraftStep" column="DPST_DRAFT_STEP"/>
        <result property="dpstDraftCurrency" column="DPST_DRAFT_CURRENCY"/>
        <result property="dpstDraftFxWithdrawCcy" column="DPST_DRAFT_FX_WDRW_CCY"/>
        <result property="dpstDraftLinkedAcctNo" column="DPST_DRAFT_LINKED_ACCT_NO"/>
        <result property="dpstDraftAutoRenewYn" column="DPST_DRAFT_AUTO_RENEW_YN"/>
        <result property="dpstDraftAutoRenewTerm" column="DPST_DRAFT_AUTO_RENEW_TERM"/>
        <result property="dpstDraftAutoTermiYn" column="DPST_DRAFT_AUTO_TERMI_YN"/>
        <result property="dpstDraftUpdatedDt" column="DPST_DRAFT_UPDATED_DT"/>
        <result property="dpstDraftAmount" column="DPST_DRAFT_AMOUNT"/>
        <result property="dpstDraftAppliedRate" column="DPST_DRAFT_APPLIED_RATE"/>
        <result property="dpstDraftAppliedFxRate" column="DPST_DRAFT_APPLIED_FX_RATE"/>
    </resultMap>

    <select id="findLatestDraft" resultMap="DepositDraftMap">
        SELECT *
        FROM (
            SELECT *
            FROM TB_DPST_ACCT_DRAFT
            WHERE TRIM(DPST_DRAFT_DPST_ID) = TRIM(#{dpstId})
              AND TRIM(DPST_DRAFT_CUST_CODE) = TRIM(#{custCode})
            ORDER BY DPST_DRAFT_UPDATED_DT DESC, DPST_DRAFT_NO DESC
        )
        WHERE ROWNUM = 1
    </select>

    <insert id="insertDraft" parameterType="kr.co.api.backend.dto.DpstAcctDraftDTO">
        INSERT INTO TB_DPST_ACCT_DRAFT (
            DPST_DRAFT_DPST_ID,
            DPST_DRAFT_CUST_CODE,
            DPST_DRAFT_MONTH,
            DPST_DRAFT_STEP,
            DPST_DRAFT_CURRENCY,
            DPST_DRAFT_FX_WDRW_CCY,
            DPST_DRAFT_LINKED_ACCT_NO,
            DPST_DRAFT_AUTO_RENEW_YN,
            DPST_DRAFT_AUTO_RENEW_TERM,
            DPST_DRAFT_AUTO_TERMI_YN,
            DPST_DRAFT_UPDATED_DT,
            DPST_DRAFT_AMOUNT,
            DPST_DRAFT_APPLIED_RATE,
            DPST_DRAFT_APPLIED_FX_RATE
        ) VALUES (
            #{dpstDraftDpstId},
            #{dpstDraftCustCode},
            #{dpstDraftMonth},
            #{dpstDraftStep},
            #{dpstDraftCurrency},
            #{dpstDraftFxWithdrawCcy},
            #{dpstDraftLinkedAcctNo},
            #{dpstDraftAutoRenewYn},
            #{dpstDraftAutoRenewTerm},
            #{dpstDraftAutoTermiYn},
            SYSDATE,
            #{dpstDraftAmount},
            #{dpstDraftAppliedRate},
            #{dpstDraftAppliedFxRate}
        )
    </insert>

    <update id="updateDraft" parameterType="kr.co.api.backend.dto.DpstAcctDraftDTO">
        UPDATE TB_DPST_ACCT_DRAFT
        SET
            DPST_DRAFT_MONTH = #{dpstDraftMonth},
            DPST_DRAFT_STEP = #{dpstDraftStep},
            DPST_DRAFT_CURRENCY = #{dpstDraftCurrency},
            DPST_DRAFT_FX_WDRW_CCY = #{dpstDraftFxWithdrawCcy},
            DPST_DRAFT_LINKED_ACCT_NO = #{dpstDraftLinkedAcctNo},
            DPST_DRAFT_AUTO_RENEW_YN = #{dpstDraftAutoRenewYn},
            DPST_DRAFT_AUTO_RENEW_TERM = #{dpstDraftAutoRenewTerm},
            DPST_DRAFT_AUTO_TERMI_YN = #{dpstDraftAutoTermiYn},
            DPST_DRAFT_UPDATED_DT = SYSDATE,
            DPST_DRAFT_AMOUNT = #{dpstDraftAmount},
            DPST_DRAFT_APPLIED_RATE = #{dpstDraftAppliedRate},
            DPST_DRAFT_APPLIED_FX_RATE = #{dpstDraftAppliedFxRate}
        WHERE DPST_DRAFT_NO = #{dpstDraftNo}
          AND TRIM(DPST_DRAFT_CUST_CODE) = TRIM(#{dpstDraftCustCode})
    </update>

    <delete id="deleteDraft">
        DELETE FROM TB_DPST_ACCT_DRAFT
        WHERE TRIM(DPST_DRAFT_DPST_ID) = TRIM(#{dpstId})
          AND TRIM(DPST_DRAFT_CUST_CODE) = TRIM(#{custCode})
    </delete>
</mapper>
